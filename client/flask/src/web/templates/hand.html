<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/hand.css') }}">
  <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      var socket;

      const host='http://localhost:8888/';


      $(document).ready(function(){
         socket = io.connect("http://localhost:8888/");

          socket.on('played', function() {
              location.reload();
          });

          socket.on('new_bet', function(data) {
              console.log("here");
              data = JSON.parse(data);
              text = "player "+data.player +" has bet " + data.bet.value + " color: " + data.bet.color ;
              if (data.played){
                console.log(text);
                document.getElementById("bets").value += text + "\n"
              }
          });

      });

  function play_a_card(card_index,player) {
        let Http = new XMLHttpRequest();

        if(Http) {
          Http.onreadystatechange = function() {
                if (Http.readyState == XMLHttpRequest.DONE) {
                    var jsonResponse = Http.response;
                    if(jsonResponse["result"]){
                      socket.emit('play', card_index,player)
                    }
                    else{
                      console.log("You can't play that card")
                    }
                }
            }
            Http.responseType = 'json';
            Http.open('POST',  host+"is_play_allowed/"+player, true);
            Http.setRequestHeader("Content-Type", "application/json");
            var data = JSON.stringify({"card": card_index});
            Http.send(data);
        }
      };

      function bet(player) {
        let Http = new XMLHttpRequest();

        value =$("#value-select").val()
        color = $("#color-select").val()

        if(Http) {
          Http.onreadystatechange = function() {
                if (Http.readyState == XMLHttpRequest.DONE) {
                    var jsonResponse = Http.response;
                    if(jsonResponse["result"]){
                      socket.emit('bet',data,player)
                    }
                    else{
                      console.log("You can't make that bet")
                    }
                }
            }
            Http.responseType = 'json';
            Http.open('POST',  host+"is_bet_allowed/"+player, true);
            Http.setRequestHeader("Content-Type", "application/json");
            var data = JSON.stringify({"value": value,"color":color});
            Http.send(data);
        }
      };


  </script>

</head>


<body>


<div class="hand">
  {%for i in range(len_card)%}
  <div class="card">
        <img src="{{ url_for('static', filename='card_game/'+Cards[i]+'.png') }}" align="left" alt="{{card}}" style="width:100%;height:100%" onclick="play_a_card({{i}},{{player}});">
  </div>
  {% endfor %}
</div>

{%for i in range(len_trick)%}
  {% if not( trick[i] == "") %}
  <div class="{{"trick" + trick_str[i]}}">

    <div class="card">
          <img src="{{ url_for('static', filename='card_game/'+trick[i]+'.png') }}" align="left" alt="{{trick[i]}}" style="width:100%;height:100%">
    </div>
  </div>
  {% endif %}
{% endfor %}


<select name="bets" id="value-select">
  <option value="">--Please choose an bet--</option>
  {%for bet in bets_available%}
    <option value="{{bet}}">{{bet}}</option>
  {% endfor %}
</select>

<select name="color" id="color-select">
  <option value="">--Please choose an color--</option>
  {%for color in colors%}
    <option value="{{color}}">{{color}}</option>
  {% endfor %}
</select>

<button type="button" onclick="bet({{player}});">bet </button>
<textarea id="bets" cols="50" rows="5"></textarea><br><br>
</body>
</html>
